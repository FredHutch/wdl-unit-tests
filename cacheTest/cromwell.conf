include required(classpath("application"))

backend {
  default = "LocalExample"
  providers {
    LocalExample {
      actor-factory = "cromwell.backend.impl.sfs.config.ConfigBackendLifecycleActorFactory"
      config {
        runtime-attributes = """
          Int? cpu
          Int? memory_mb
          String? docker
        """
        
        submit-docker = """
          docker run \
            --cidfile ${cwd}/docker_cid \
            -i \
            --rm \
            -v ${cwd}:${docker_cwd} \
            --entrypoint /bin/bash \
            ${docker} \
            -c "${script}"
        """

        # Enable call caching
        call-caching {
          enabled = true
          invalidate-bad-cache-results = true
        }

        # File system configuration
        filesystem {
          local {
            localization: [
              "hard-link", "soft-link", "copy"
            ]
            caching {
              duplication-strategy: [
                "hard-link", "soft-link", "copy"
              ]
            }
          }
        }

        concurrent-job-limit = 5
        
        # Docker-specific configurations
        docker {
          hash-lookup {
            enabled = true
            # Set to false if you want to disable docker image caching
            caching {
              enabled = true
              duplication-strategy = ["hard-link", "copy"]
            }
          }
          
          # Kill containers after a timeout
          kill-after = 5 minutes
        }
      }
    }
  }
}

call-caching {
  enabled = true
  invalidate-bad-cache-results = true
  # How long to keep cache entries (30 days)
  ttl = 2592000
}

# Database configuration
database {
  profile = "slick.jdbc.HsqldbProfile$"
  db {
    driver = "org.hsqldb.jdbcDriver"
    url = "jdbc:hsqldb:file:cromwell-db;shutdown=false;hsqldb.tx=mvcc"
    connectionTimeout = 120000
    numThreads = 1
  }
}