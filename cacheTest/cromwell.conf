include required(classpath("application"))

backend {
  default = "LocalExample"
  providers {
    LocalExample {
      actor-factory = "cromwell.backend.impl.sfs.config.ConfigBackendLifecycleActorFactory"
      config {
        runtime-attributes = """
          Int? cpu
          Int? memory_mb
          String? docker
        """
        
        submit-docker = """
            docker run \
              --cidfile ${cwd}/docker_cid \
              -i \
              --rm \
              -v ${cwd}:${docker_cwd} \
              -w ${docker_cwd} \
              ${docker} \
              /bin/bash ${script}
        """

        # The script is written to this path in the container
        script-epilogue = "sleep 1"
        
        # File system configuration
        filesystem {
          local {
            localization: [
              "hard-link", "soft-link", "copy"
            ]
            caching {
              duplication-strategy: [
                "hard-link", "soft-link", "copy"
              ]
            }
          }
        }

        call-caching {
          enabled = true
          invalidate-bad-cache-results = true
        }
      }
    }
  }
}

call-caching {
  enabled = true
  invalidate-bad-cache-results = true
}